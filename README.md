## Summary of Language Projects 2023

September 2023

These are private languages of mine. This is where docs and summaries about them come together.

### Languages
```
Language  Description (Notes)

M         Lower level systems language
Q         Lower level dynamic scripting language
ASM       x64 assembly in my take on Intel syntax
PCL       Intermediate language similar to the IL of the M compiler (1)
ZA        Z80 assembly based around Zilog syntax (2)
MS        New embedded scripting language based on a cut-down Q language (9)
'C'       C subset used by mcc compilers
```
### Tools
```
Tool      Folder  Impl In  Description

mm.exe    mx      M        M Compiler
 mc.exe   mxc     M        M to C transpiler (11)
 mmp.exe  px      M        Independent M compiler that generates textual PCL files
 run.exe  mx      M        Stub program to run .mx executables (4)

pci.exe   px      M        Interpreter of of PCL files

aa.exe    ax      M        ASM assembler

qq.exe    qx      M        Q bytecode compiler and interpreter

ms.exe    bx      M        MS compiler and interpreter (WIP)

zz.qa     zx      Q        ZA assembler

mcc.exe   cx      M        C subset compiler (10)
 ccm.exe  ccx     M        C to M visualiser (12)
 bcc.exe  bcx     M        C subset compiler (10)

```

### File Extensions
```
Extension  Represents  Description

.m         Module      M source file
.ma        Program     M amalgamated source file (5)
.ml        Library     Private shared library format (4)
.mx        Program     Private executable code format
.exp       Library     Temporary output file of -ml/-mx options: exports info

.pcl       Program     PCL source code

.asm       Program*    AA assembly source file (*Module when generated by BCC compiler)

.q         Module      Q source file
.qa        Program     Q amalgamated source file (6)

.ms        Program     MS source file

.za        Program     ZA assembly source file (there are no modules)

.exe       Program     Windows executable file (PE+)
.dll       Library     Windows shared dynamic library (PE+) (7)
.obj       Program*    Object file (COFF64/PE+) (* Can be module) (8)
```

### Inputs and Outputs
```
Tool      Input   N   Output   Option    Description

mm.exe    .m .ma  1   .exe     -exe      (Default) Compile to executable
                      .asm     -asm      Write single-file assembly file
                      .ma      -ma       Write amalgamated source file
                               -mas      Same but includes standard library files
                      .ml      -ml       Write shared library file in private format
                      .mx      -mx       Write executable in private format
                      Run      -run      Compile and run in-memory (ms.exe is better for this)

qq.exe    .q .qa  1   Run                (Default) Compile and run bytecode in-memory
                      .qa      -qa       Write amalgamated source file ...
                               -qas      ... with standard library

ms.exe    .ms     1   Run                Run MS script in standalone or embedded interpreter

aa.exe    .asm    N  .exe      -exe      (Default) Create executable
                     .obj      -obj      Write single object file (6)
                     .dll      -dll      Write DLL file (7)

mmp.exe   .m .ma  1  .pcl                Compile to single PCL source file

pci.exe   .pcl    1  Run                 Interpret PCL program

run.exe   .mx     1  Run                 Run .mx application

zz.qa     .za     1  -         -asm      (Default) Assemble to in-memory machine code
                     Run       -run      (Not ready) Assemble and run

mcc.exe   .c      N  .exe      -exe      (Default) Compile .c files to .exe via .asm/aa.exe
                     .obj      -c        Compile individual .c files to .obj via .asm/aa.exe
                     .asm      -s        Compile individual .c files to .asm
                     .i        -e        Preprocess individual .c files to .i
                     .m        -mheaders Translate headers to M syntax in .m file

mc.exe    .m      1  .exe      -gcc      (Default) Transpile M project to one C file then invoke gcc
                               -tcc      Use tcc
                               -mcc      Use mcc
                     .c        -c        Transpile to C only

ccm       .c      N  .m                  Informally convert to M syntax
```

N indicates the number of input files accepted. Only `mcc.exe`, and `aa.exe` because it was used to combine .asm outputs of BCC/MCC, accept multiple source files. All my own languages generally work from a single submitted module.

### Notes

**(1)** `PCL` was the name of the discrete IL I'd planned for the M compiler, and I also worked on an interpreter for it. But the project became too much and was dropped. The special M compiler `mmp.exe` and the interpreter `pci.exe` are retained as an independent project. I had ideas of using it as a debugging tool for M programs

**(2)** This was a project involving a Z80 assembler (completed), and an emulator (just started). It was shelved when I realised how much effort was needed to properly emulate Z80.

**(4)** (See **7**) Because of problems with DLLs, I created my own simpler shared library format using `.ml` files. These are accepted by Q programs, but in M, can only be transparently used by `.mx` files, or accessed via a special API from regular `.exe`.

The format can also be used to write complete apps, with `.mx` extension, but being unknown to Windows, those must be started by a stub program `run.exe`

**(5)** The `-ma` option of M compiler combines all source files and support files (from `include` and `strinclude`) into a single file. This is easy to backup, transmit, copy etc. And it can be directly be compiled in that form: `mm prog.ma`.

**(6)** The `-qa` option does a similar job for Q programs, and there is is necessary for packaging applications, as there is no longer a binary file format for bytecode

**(7)** `mm.exe` used to produce DLL files, which could be relocated with the low 2GB of virtual address space. But sometimes it can be loaded higher, and I think that caused the problems I sometimes had. Loading above 2GB requires RIP-relative addressing, and other code-generation to choices to get around the problem of absolute addresses above 2GB not fitting into a 32-bit field. My code generators don't yet do that.

**(8)** OBJ files can still be produced by `aa.exe`, to allow combining with other software. But they need a third party linker, and these now like to create images that can also be loaded above 2GB. So at present DLL and OBJ outputs are shelved until I can sort that out.

**(9)** MS is a new project just started. Short for M-Script.

**(10)** MCC was a Sep 23 project to replace the backend of the older BCC compiler, which the same IL+backend used by my M compilers. In the end, the IL was revised quite a bit as the machine model of C is different. The optimising features are not yet enabled/debugged. I had hoped to have a direct-to-EXE backend developed too, but I lost interest and ran out of time. BCC had the AA assembler built-in; MCC invokes it as a separate program. Yet MCC can still do the job of compiling C code.

**11** MC was an M to C transpiler. It only supported a subset of M (so certain M features couldn't be used), and had been archived, but is once again because it is too useful.

**(12) CCM is another archived project. I had intended to take this further as a full C to M translator, but the task is too difficult. As it is, translates C to M-like syntax purely for visualisation. A few more things can be done to improve that, such as output enum names and simple #defines as their names rather than constants, but it is still a visualiser: M syntax, but C semantics still.
